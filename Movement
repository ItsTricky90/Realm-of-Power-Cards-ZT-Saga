extends KinematicBody

var speed = 5.0
var gravity = -9.8
var velocity = Vector3()

func _physics_process(delta):
    # Input handling
    var move_direction = Vector3()
    move_direction.x = Input.get_action_strength("move_right") - Input.get_action_strength("move_left")
    move_direction.z = Input.get_action_strength("move_back") - Input.get_action_strength("move_forward")
    
    # Camera direction
    var camera_transform = $Camera.get_transform()
    var camera_basis = camera_transform.basis
    move_direction = camera_basis.xform(move_direction).normalized()
    
    # Apply gravity
    velocity.y += gravity * delta

    # Calculate motion
    var motion = move_direction * speed
    motion.y = velocity.y

    motion = move(motion * delta)
    
    # Reset vertical velocity when grounded
    if is_on_floor():
        velocity.y = 0

